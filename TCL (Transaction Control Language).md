

### ЁЯз╛ TCL ржХрзА?

**TCL (Transaction Control Language)** тАФ ржпрж╛ **Transaction** ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржУ ржирж┐рзЯржирзНрждрзНрж░ржгрзЗрж░ ржЬржирзНржп ржмрзНржпржмрж╣рзГржд рж╣рзЯред ржПржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣рзЯ ржпржЦржи ржПржХрж╛ржзрж┐ржХ SQL ржЕржкрж╛рж░рзЗрж╢ржи **ржПржХрж╕рж╛ржерзЗ (transaction рж╣рж┐рж╕рзЗржмрзЗ)** ржЪрж╛рж▓рж╛рждрзЗ рж╣рзЯ, ржпрж╛рждрзЗ рж╕ржмржЧрзБрж▓рзЛ рж╕ржлрж▓ рж╣рж▓рзЗ ржПржХрж╕рж╛ржерзЗ ржХржорж┐ржЯ рж╣рзЯ, ржЖрж░ ржХрзЛржирзЛ ржПржХржЯрж┐рждрзЗ рж╕ржорж╕рзНржпрж╛ рж╣рж▓рзЗ ржкрзБрж░рзЛ ржЯрзНрж░рж╛ржирзНрж╕ржЕрзНржпрж╛ржХрж╢ржи **rollback** рж╣рзЯрзЗ ржпрж╛рзЯред

---

### ЁЯФ╣ ржкрзНрж░ржзрж╛ржи ржХржорж╛ржирзНржб:

|Command|ржХрж╛ржЬ|
|---|---|
|`COMMIT`|ржЯрзНрж░рж╛ржирзНрж╕ржЕрзНржпрж╛ржХрж╢ржи рж╕ржлрж▓ржнрж╛ржмрзЗ рж╕ржорзНржкржирзНржи ржХрж░рзЗ рж╕рзНржерж╛рзЯрзА ржХрж░рзЗ|
|`ROLLBACK`|ржХрзЛржирзЛ ржнрзБрж▓ рж╣рж▓рзЗ ржЖржЧрзЗрж░ ржЕржмрж╕рзНржерж╛рзЯ ржлрж┐рж░рзЗ ржпрж╛рзЯ|
|`SAVEPOINT`|ржЯрзНрж░рж╛ржирзНрж╕ржЕрзНржпрж╛ржХрж╢ржирзЗрж░ ржорж╛ржЭрзЗ ржПржХржЯрж┐ ржЪрзЗржХржкржпрж╝рзЗржирзНржЯ рждрзИрж░рж┐ ржХрж░рзЗ|
|`SET TRANSACTION`|ржЯрзНрж░рж╛ржирзНрж╕ржЕрзНржпрж╛ржХрж╢ржирзЗрж░ ржЖрж▓рж╛ржжрж╛ ржмрзИрж╢рж┐рж╖рзНржЯрзНржп ржирж┐рж░рзНржзрж╛рж░ржг ржХрж░рзЗ (ржХржо ржмрзНржпржмрж╣рзГржд)|

---

## тЬЕ ржмрж╛рж╕рзНрждржм ржЙржжрж╛рж╣рж░ржг: E-commerce Context

ржзрж░рж┐ ржЖржорж░рж╛ ржжрзБржЯрж┐ ржЯрзЗржмрж┐рж▓рзЗ ржХрж╛ржЬ ржХрж░ржЫрж┐:  
ЁЯЫТ `orders` ржПржмржВ `payments`

```sql
START TRANSACTION;

-- 1. ржирждрзБржи ржЕрж░рзНржбрж╛рж░ ржпрзЛржЧ ржХрж░рзЛ
INSERT INTO orders (customer_id, product_id, quantity) VALUES (1, 101, 2);

-- 2. ржкрзЗржорзЗржирзНржЯ ржПржирзНржЯрзНрж░рж┐ ржХрж░рзЛ
INSERT INTO payments (order_id, amount, status) VALUES (LAST_INSERT_ID(), 3000, 'pending');

-- ржпржжрж┐ рж╕ржмржХрж┐ржЫрзБ ржарж┐ржХ ржерж╛ржХрзЗ, рждрж╛рж╣рж▓рзЗ ржХржорж┐ржЯ ржХрж░рзЛ
COMMIT;
```

ЁЯФ╕ ржПржЗ `COMMIT` ржжрж┐рж▓рзЗ ржкрзБрж░рзЛ ржЯрзНрж░рж╛ржирзНрж╕ржЕрзНржпрж╛ржХрж╢ржи рж╕рзНржерж╛рзЯрзА рж╣ржмрзЗред

---

### тЭМ ржпржжрж┐ ржХрзЛржирзЛ ржнрзБрж▓ рж╣рзЯ, рждрж╛рж╣рж▓рзЗ:

```sql
START TRANSACTION;

-- ржЕрж░рзНржбрж╛рж░ ржврзБржХрж╛ржирзЛ
INSERT INTO orders (customer_id, product_id, quantity) VALUES (2, 202, 1);

-- ржнрзБрж▓ payment query
INSERT INTO payments (order_id, amount, status) VALUES (9999, 3000, 'pending'); -- ржнрзБрж▓ order_id

-- рж╕ржорж╕рзНржпрж╛ ржмрзБржЭрзЗ рж░рзЛрж▓ржмрзНржпрж╛ржХ
ROLLBACK;
```

ЁЯФ╕ ржкрзБрж░рзЛ ржЯрзНрж░рж╛ржирзНрж╕ржЕрзНржпрж╛ржХрж╢ржи ржмрж╛рждрж┐рж▓ рж╣ржмрзЗ, ржХрзЛржирзЛ ржбрзЗржЯрж╛ржЗ ржерж╛ржХржмрзЗ ржирж╛ред

---

### ЁЯУН SAVEPOINT ржмрзНржпржмрж╣рж╛рж░:

```sql
START TRANSACTION;

INSERT INTO orders (customer_id, product_id, quantity) VALUES (3, 301, 1);
SAVEPOINT after_order;

INSERT INTO payments (order_id, amount, status) VALUES (LAST_INSERT_ID(), 5000, 'failed');

-- ржпржжрж┐ payment рж╕ржорж╕рзНржпрж╛ ржХрж░рзЗ
ROLLBACK TO after_order;

-- ржПрж░ржкрж░ ржарж┐ржХ ржерж╛ржХрж▓рзЗ
COMMIT;
```

ЁЯФ╕ `SAVEPOINT` ржжрж┐рзЯрзЗ рждрзБржорж┐ ржЖржВрж╢рж┐ржХ rollback ржХрж░рждрзЗ ржкрж╛рж░рзЛ тАФ ржкрзБрж░рзЛржЯрж╛ржЗ ржирж╛ред

---

## ЁЯУМ рж╕ржВржХрзНрж╖рзЗржкрзЗ TCL:

|Command|ржХрж╛ржЬ|
|---|---|
|`START TRANSACTION`|ржЯрзНрж░рж╛ржирзНрж╕ржЕрзНржпрж╛ржХрж╢ржи рж╢рзБрж░рзБ ржХрж░рзЗ|
|`COMMIT`|ржкрж░рж┐ржмрж░рзНрждржи рж╕рзНржерж╛рзЯрзА ржХрж░рзЗ|
|`ROLLBACK`|рж╕ржм ржкрж░рж┐ржмрж░рзНрждржи ржмрж╛рждрж┐рж▓ ржХрж░рзЗ|
|`SAVEPOINT`|ржорж╛ржЭржкржерзЗ ржлрж┐рж░рзЗ ржпрж╛ржУрзЯрж╛рж░ ржкрзЯрзЗржирзНржЯ|
|`ROLLBACK TO SAVEPOINT`|ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржкрзЯрзЗржирзНржЯ ржкрж░рзНржпржирзНржд ржлрж┐рж░рзЗ ржпрж╛рзЯ|

---

ржПржЗ ржЬрж┐ржирж┐рж╕ржЧрзБрж▓рзЛ ржорзВрж▓ржд рждржЦржиржЗ ржХрж╛ржЬрзЗ рж▓рж╛ржЧрзЗ ржпржЦржи ржбрзЗржЯрж╛ржмрзЗржЬрзЗ **multiple steps** ржП ржХрж╛ржЬ ржХрж░рждрзЗ рж╣рзЯред ржпрзЗржоржиржГ order тЖТ payment тЖТ stock update тАФ ржпрж╛рждрзЗ рж╕ржм ржПржХрж╕рж╛ржерзЗ рж╕ржлрж▓ рж╣рзЯ ржЕржержмрж╛ рж╕ржм ржмрж╛рждрж┐рж▓ рж╣рзЯред

